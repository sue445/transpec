<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="Yuji Nakayama" name="author" /><meta content="Transpec - A magical tool for converting your specs to the latest RSpec syntax." name="description" /><title>Transpec</title><link href="stylesheets/all-c2d5bf91.css" media="screen" rel="stylesheet" type="text/css" /></head><body class="index"><div class="masthead"><div class="screen-fill"></div><div class="fluid-container"><div class="row"><div class="col-sm-5 title"><h1>Transpec</h1><p class="lead">A magical tool for converting your specs to the latest <strong>RSpec</strong> syntax.</p><a class="github btn" href="https://github.com/yujinakayama/transpec">View on GitHub</a></div><div class="col-sm-7"><div class="player-wrapper"><div class="player small-font"></div></div></div></div></div></div><div class="content"><div class="features"><div class="container"><div class="row"><div class="col-sm-4"><h3>RSpec 3 ready</h3><p>Transpec lets you upgrade your RSpec 2 specs to RSpec 3 beta in no time.
It supports <a href="https://github.com/yujinakayama/transpec#supported-conversions">conversions</a> for almost all of the RSpec 3 changes.</p><p>Also, you can use it on your RSpec 2 project
even if you're not going to upgrade it to RSpec 3 for now.</p></div><div class="col-sm-4"><h3>Ruby-aware</h3><p>Transpec parses your Ruby codes with static code analysis.
This means that it can recognize whether a <code>mock</code> is a method invocation or a local variable.</p><p>Furthermore, with dynamic code analysis,
it inspects whether a <code>mock</code> is a RSpec method or another method with the same name.</p></div><div class="col-sm-4"><h3>Sane code style</h3><p>You don't want to rewrite your specs by hand
nor do you want a quick-and-dirty job by poorly written software.</p><p>Transpec converts your specs while honoring your code style
such as line breaks, indentations and parentheses as much as possible.
Also, the conversion behavior can be customized with <a href="https://github.com/yujinakayama/transpec#options">command line options</a>.</p></div></div></div></div><div class="document"><h2>Example</h2>

<p>Here&rsquo;s an example spec:</p>
<pre class="highlight ruby"><span class="n">describe</span> <span class="no">Account</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:account</span><span class="p">)</span> <span class="p">{</span> <span class="no">Account</span><span class="nf">.new</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:logger</span><span class="p">)</span> <span class="p">{</span> <span class="n">mock</span><span class="p">(</span><span class="s1">&#39;logger&#39;</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;#balance&#39;</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">&#39;initially&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;is zero&#39;</span> <span class="k">do</span>
        <span class="n">account</span><span class="nf">.balance.should</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#close&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;logs an account closed message&#39;</span> <span class="k">do</span>
      <span class="n">logger</span><span class="nf">.should_receive</span><span class="p">(</span><span class="ss">:account_closed</span><span class="p">)</span><span class="nf">.with</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
      <span class="n">account</span><span class="nf">.close</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#renew&#39;</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">&#39;when the account is renewable and not closed&#39;</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="n">account</span><span class="nf">.stub</span><span class="p">(</span><span class="ss">:renewable?</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:closed?</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s1">&#39;does not raise error&#39;</span> <span class="k">do</span>
        <span class="nb">lambda</span> <span class="p">{</span> <span class="n">account</span><span class="nf">.renew</span> <span class="p">}</span><span class="nf">.should_not</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">Account</span><span class="o">::</span><span class="no">RenewalError</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>Transpec would convert it to the following form:</p>
<pre class="highlight ruby"><span class="n">describe</span> <span class="no">Account</span> <span class="k">do</span>
  <span class="n">subject</span><span class="p">(</span><span class="ss">:account</span><span class="p">)</span> <span class="p">{</span> <span class="no">Account</span><span class="nf">.new</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:logger</span><span class="p">)</span> <span class="p">{</span> <span class="n">double</span><span class="p">(</span><span class="s1">&#39;logger&#39;</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s1">&#39;#balance&#39;</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">&#39;initially&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;is zero&#39;</span> <span class="k">do</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">account</span><span class="nf">.balance</span><span class="p">)</span><span class="nf">.to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#close&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;logs an account closed message&#39;</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span><span class="nf">.to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:account_closed</span><span class="p">)</span><span class="nf">.with</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
      <span class="n">account</span><span class="nf">.close</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#renew&#39;</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">&#39;when the account is renewable and not closed&#39;</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="n">allow</span><span class="p">(</span><span class="n">account</span><span class="p">)</span><span class="nf">.to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:renewable?</span><span class="p">)</span><span class="nf">.and_return</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
        <span class="n">allow</span><span class="p">(</span><span class="n">account</span><span class="p">)</span><span class="nf">.to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:closed?</span><span class="p">)</span><span class="nf">.and_return</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="s1">&#39;does not raise error&#39;</span> <span class="k">do</span>
        <span class="n">expect</span> <span class="p">{</span> <span class="n">account</span><span class="nf">.renew</span> <span class="p">}</span><span class="nf">.not_to</span> <span class="n">raise_error</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<h2>Installation</h2>

<p>Simply install <code>transpec</code> with <code>gem</code> command:</p>
<pre class="highlight shell"><span class="gp">$ </span>gem install transpec
</pre>
<p>Usually you don&rsquo;t need to add <code>transpec</code> to your <code>*.gemspec</code> or <code>Gemfile</code> since this isn&rsquo;t a tool to be used daily.</p>

<h2>Basic Usage</h2>

<p>Before converting your specs:</p>

<ul>
<li>Make sure your project has <code>rspec</code> gem dependency <strong>2.14</strong> or later. If not, change your <code>*.gemspec</code> or <code>Gemfile</code> to do so.</li>
<li>Run <code>rspec</code> and check if all the specs pass.</li>
<li>Ensure the Git repository is clean. (You don&rsquo;t want to mix up your changes and Transpec&rsquo;s changes, do you?)</li>
</ul>

<p>Then, run <code>transpec</code> in the project root directory:</p>
<pre class="highlight shell"><span class="gp">$ </span><span class="nb">cd </span>some-project
<span class="gp">$ </span>transpec
Copying the project <span class="k">for </span>dynamic analysis...
Running dynamic analysis with <span class="nb">command</span> <span class="s2">&quot;bundle exec rspec&quot;</span>...
...............................................................................
...................

Finished <span class="k">in </span>13.07 seconds
100 examples, 0 failures

Converting spec/spec_helper.rb
Converting spec/support/cache_helper.rb
Converting spec/support/file_helper.rb
Converting spec/support/shared_context.rb
Converting spec/transpec/ast/node_spec.rb
</pre>
<p>This will run the specs, convert them, and overwrite all spec files in the <code>spec</code> directory.</p>

<p>After the conversion, run <code>rspec</code> again and check whether everything is green:</p>
<pre class="highlight shell"><span class="gp">$ </span>bundle <span class="nb">exec </span>rspec
</pre>
<p>If it&rsquo;s green, commit the changes with an auto-generated message that describes the conversion summary:</p>
<pre class="highlight shell"><span class="gp">$ </span>git commit -aeF .git/COMMIT_EDITMSG
</pre>
<p>And you are done!</p>
</div></div><footer><p>Developed by <a href="https://twitter.com/nkym37">Yuji Nakayama</a>. The terminal player is powered by <a href="https://github.com/sickill/asciinema.org">asciinema.org</a>.</p></footer><script src="javascripts/all-126c8956.js" type="text/javascript"></script><script type="text/javascript">(function() {
  var playTerminal = function playTerminal() {
    window.mainWorkerPath = "javascripts/asciinema_main_worker-29b365ca.js";
    window.player = new Asciinema.Player({
      el: $('.player'),
      speed: 1.0,
      model: new Asciinema.Asciicast({
        id: 6647,
        duration: 57.4243969917297,
        stdout_frames_url: 'asciinema/stdout.json',
        width: 80,
        height: 24
      }),
      rendererClass: Asciinema.Renderer.Pre,
      autoPlay: true,
      hud: false
    });
  };

  $(document).ready(function() {
    setTimeout(function() {
      $('.masthead').addClass('demo-scene');
      setTimeout(playTerminal, 900);
    }, 1200);
  });
})();</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-46262891-1', 'yujinakayama.me');
ga('send', 'pageview');</script></body></html>